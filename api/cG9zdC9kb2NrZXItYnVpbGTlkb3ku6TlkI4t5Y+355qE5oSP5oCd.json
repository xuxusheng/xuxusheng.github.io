{"title":"docker build命令后 . 号的意思","date":"2018-03-09T19:46:59.000Z","author":"许盛","excerpt":"<p>我们在使用 <code>docker build</code> 命令去构建镜像时，往往会看到命令最后会有一个 <code>.</code> 号。</p>","slug":"docker-build命令后-号的意思","comments":true,"tags":["docker"],"categories":["docker"],"updated":"2018-08-23T07:40:05.936Z","content":"<p>我们在使用 <code>docker build</code> 命令去构建镜像时，往往会看到命令最后会有一个 <code>.</code> 号。</p>\n<a id=\"more\"></a>\n<blockquote>\n<p>参考文章: <a href=\"https://yeasy.gitbooks.io/docker_practice/content/image/build.html\" target=\"_blank\" rel=\"noopener\">https://yeasy.gitbooks.io/docker_practice/content/image/build.html</a></p>\n</blockquote>\n<p>比如：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker build -t xxx .</span><br></pre></td></tr></table></figure>\n<p>那么这里的 <code>.</code> 号代表什么意思呢？</p>\n<p>在跟后端小悦悦同学交流的过程中，就发现小悦悦同学对 <code>.</code> 号的理解有所偏差，以为是用来指定 <code>Dockerfile</code> 文件所在的位置的，但其实 <code>-f</code> 参数才是用来指定 <code>Dockerfile</code> 的路径的，那么 <code>.</code> 号究竟是用来做什么的呢？</p>\n<hr>\n<p><code>Docker</code> 在运行时分为 <code>Docker引擎（服务端守护进程）</code> 以及 <code>客户端工具</code>，我们日常使用各种 <code>docker 命令</code>，其实就是在使用客户端工具与 <code>Docker 引擎</code> 进行交互。</p>\n<p>那么当我们使用 <code>docker build</code> 命令来构建镜像时，这个构建过程其实是在 <code>Docker引擎</code> 中完成的，而不是在本机环境。</p>\n<p>那么如果在 <code>Dockerfile</code> 中使用了一些 <code>COPY</code> 等指令来操作文件，如何让 <code>Docker引擎</code> 获取到这些文件呢？</p>\n<p>这里就有了一个 <code>镜像构建上下文</code> 的概念，当构建的时候，由用户指定构建镜像的上下文路径，而 <code>docker build</code> 会将这个路径下所有的文件都打包上传给 <code>Docker 引擎</code>，引擎内将这些内容展开后，就能获取到所有指定上下文中的文件了。</p>\n<p>比如说 <code>dockerfile</code> 中的 <code>COPY ./package.json /project</code>，其实拷贝的并不是本机目录下的 <code>package.json</code> 文件，而是 <code>docker引擎</code> 中展开的构建上下文中的文件，所以如果拷贝的文件超出了构建上下文的范围，<code>Docker引擎</code> 是找不到那些文件的。</p>\n<hr>\n<p>所以 <code>docker build</code> 最后的 <code>.</code> 号，其实是在指定镜像构建过程中的上下文环境的目录。</p>\n<p>理解了上面的这些概念，就更方便的去理解 <code>.dockerignore</code> 文件的作用了。</p>\n<p>关于 <code>.dockerignore</code> 的使用参见另一篇博文：<a href=\"https://blog.xuxusheng.com/post/dockerignore%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8\" target=\"_blank\" rel=\"noopener\">.dockerignore 文件的作用</a></p>\n","prev":{"title":".dockerignore文件的作用","slug":"dockerignore文件的作用"},"next":{"title":"2017半载小记","slug":"2017半载小记"},"link":"/post/docker-build命令后-号的意思"}